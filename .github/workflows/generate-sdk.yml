name: Generate clients
on: 
  push:
  workflow_dispatch:
jobs:
  generate-sdk:
    runs-on: ubuntu-latest
    name: Generate Go SDK
    steps:
    - uses: actions/checkout@master
    - name: Set up Go
      uses: actions/setup-go@v5
      with:
        go-version: 'stable'

    - name: Cleanup old client
      run: rm -rf go-client/

    - name: Generate new client
      uses: openapi-generators/openapitools-generator-action@v1
      with:
        generator: go
        openapi-url: https://raw.githubusercontent.com/Crspy2/developers/main/api-reference/openapi.json
        command-args: packageName=sellix

    - name: TEST
      run: ls -al --color=auto
    
    - name: Tidy Go Modules
      working-directory: go-client
      run: go mod tidy

    - name: Run Go Tests
      working-directory: go-client
      run: go test ./test
    
    - name: Commit new client
      run: |
        git config --global user.name 'Crspy'
        git config --global user.email 'crspy8687@gmail.com'
        git add go-client/
        git commit -am "Update golang client"
        git push
